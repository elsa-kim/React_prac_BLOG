# 백엔드

백엔드 프로그래밍(서버 프로그래밍) : 어떤 종류의 데이터를 몇 개씩 보여줄지, 어떻게 보여줄지 등에 관한 로직 만드는 것

## Node.js

자바스크립트 엔진을 기반으로 웹 브라우저뿐 아니라 서버에서도 자바스크립트를 사용할 수 있는 런타임 개발한 것

- Node.js 환경에서 웹 서버 구축할 때 보통 Express, Hapi, Koa 등의 웹 프레임워크 사용

## Koa

Express 개발 팀이 개발한 프레임워크

- Express VS Koa
  - Express : 미들웨어, 라우팅, 템플릿, 파일 호스팅 등과 같은 다양한 기능 자체적 내장
  - Koa : 미들웨어 기능만 갖추고 있으며 나머지는 다른 라이브러리 적용해 사용, 필요한 기능들만 붙여 서버 만들 수 있기 때문에 Express보다 훨씬 가벼움, async/await 문법 정식지원해 비동기 작업 더 편리하게 관리 가능

### 미들웨어

Koa 애플리케이션은 미들웨어의 배열로 구성되어 있음, 미들웨어 함수는 두 개의 파라미터 받음

- 미들웨어 함수 구조 : (ctx, next) => {}
  - ctx : Context의 줄임말로 웹 요청과 응답에 관한 정보 지님
  - next : 현재 처리중인 미들웨어의 마음 미들웨어를 호출하는 함수, 미들웨어 등록하고 next 함수 호출하지 않으면 그 다음 미들웨어 처리하지 않음, 미들웨어에서 next 사용하지 않으면 파라미터에 설정 안해도 됨(주로 다음 미들웨어 처리할 필요 없는 라우트 미들웨어를 나중에 설정할 때 이러한 구조 사용)
- 미들웨어는 app.use 사용해 등록되는 순서대로 처리됨

### next 함수는 Promise 반환

- Koa가 Express와 차별화되는 부분
- next 함수가 반환하는 Promise는 다음에 처리해야 할 미들웨어가 끝나야 완료됨

### async/await 사용

- Express도 async/await 문법 사용할 수 있지만 오류 처리하는 부분 제대로 작동 안할 수 있음, 예상치 못한 에러 잡아내려면 express-async-errors 라이브러리 사용해야 함

### koa-router 사용

다른 주소로 요청 들어올 경우 다른 작업 처리할 수 있도록 라우터 사용해야하는데 Koa 자체에 내장되어 있지않아 koa-router 모듈 설치해야 함

- 라우트 설정시 첫번째 파라미터에는 라우트 경로를 넣고, 두번째 파라미터에는 해당 라우트에 적용할 미들웨어 함수 넣음

#### 라우트 파라미터와 쿼리

- 파라미터 :
  - '/about/:name' 형식으로 콜론 사용
  - 파라미터 있을 수도 있고 없을 수도 있다면 파라미터 이름 뒤 물음표 사용
  - 파라미터 함수는 ctx.params 객체에서 조회 가능
- URL 쿼리 :
  - '/posts/?id=10' 형식으로 값 요청
  - ctx.query에서 조회 가능
  - 문자열 형태 쿼리 문자열 조회해야 할 때는 ctx.querystring 사용
